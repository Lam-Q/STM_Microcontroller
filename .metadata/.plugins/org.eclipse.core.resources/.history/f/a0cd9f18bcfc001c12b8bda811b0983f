/*
 * Stm32f407vg_spi_driver.c
 *
 *  Created on: Jul 4, 2022
 *      Author: lamqi
 */

#include "stm32F407vg_spi_driver.h"


/*
 *  Peripheral clock setup
 */
/*************************************************************************
 * @fn   			- SPI_PeriClock Control
 *
 * @param[in]		- base address of the SPI peripheral
 * @param[in]		- ENABLE or DISABLE macros
 * @param[in]
 *
 * @return			- none
 *
 * @Note			- none
 *
 ***************************************************************************/

void SPI_PeriClockControl(SPI_RegDef_t *pSPIx, uint8_t EnorDi)
{
	if(EnorDi == ENABLE)
	{
		if(pSPIx == SPI1)
		{
			SPI1_PCLK_EN();
		}
		else if (pSPIx == SPI2)
		{
			SPI2_PCLK_EN();
		}
		else if (pSPIx == SPI3)
		{
			SPI3_PCLK_EN();
		}
		else if (pSPIx == SPI4)
		{
			SPI4_PCLK_EN();
		}
	}
	else
	{
		if(pSPIx == SPI1)
		{
			SPI1_PCLK_DI();
		}
		else if (pSPIx == SPI2)
		{
			SPI2_PCLK_DI();
		}
		else if (pSPIx == SPI3)
		{
			SPI3_PCLK_DI();
		}
		else if (pSPIx == SPI4)
		{
			SPI4_PCLK_DI();
		}
	}
}
/*
 * SPI init and De-init
 */
/*************************************************************************
 * @fn   			- SPI_Init
 *
 * @param[in]		- Handle of the SPI Peripheral
 * @param[in]		-
 * @param[in]
 *
 * @return			- none
 *
 * @Note			- none
 *
 ***************************************************************************/

void SPI_Init(SPI_Handle_t *pSPIHandle)
{
	//first lets configure the SPI_CR1 register

	uint32_t tempreg=0;

	//1. configure the device mode
	tempreg |= pSPIHandle->SPI_Config.SPI_DeviceMode << 2;

	//2. configure the bus config

	if(pSPIHandle->SPI_Config.SPI_BusConfig == SPI_BUS_CONFIG_FD)
	{
		tempreg &= ~(1 <<15);
	}
	else if(pSPIHandle->SPI_Config.SPI_BusConfig == SPI_BuS_CONFIG_HD)
	{
		tempreg |= (1 <<15);
	}
	else if(pSPIHandle->SPI_Config.SPI_BusConfig == SPI_BuS_CONFIG_SIMPLEX_RXONLY)
	{
		//BIDI mode Should be cleared
		tempreg &= ~(1 <<15);
		//RXONLY Bit must be set
		tempreg |= (1<<10);
	}

	//3. Configure the SPI Serial Clock Speed (Baud Rate)
	tempreg |= pSPIHandle->SPI_Config.SPI_SclkSpeed <<3;

	//4. Configure the SPI DFF
	tempreg |= pSPIHandle->SPI_Config.SPI_SclkSpeed <<11;

	//5. Configure the SPI CPOL
	tempreg |= pSPIHandle->SPI_Config.SPI_CPOL <<1;

	//6. Configure the SPI CPHA
	tempreg |= pSPIHandle->SPI_Config.SPI_CPHA <<0;
}

/*************************************************************************
 * @fn   			- SPI_Deinit
 *
 * @param[in]		- BASE ADDRESS of the SPI Peripheral
 * @param[in]		-
 * @param[in]
 *
 * @return			- none
 *
 * @Note			- none
 *
 ***************************************************************************/
void SPI_DeInit(SPI_RegDef_t *pSPIx); //use Peripheral RST register

/*
 * Data Send and Receive
 */

/*************************************************************************
 * @fn   			- SPI_SendData
 *
 * @param[in]		- BASE ADDRESS of the SPI Peripheral
 * @param[in]		- pTxBuffer
 * @param[in]		- Length of the message
 *
 * @return			- none
 *
 * @Note			- none
 *
 ***************************************************************************/

void SPI_SendData(SPI_RegDef_t *pSPIx, uint8_t *pTxBuffer, uint32_t Len)
{

}
/*************************************************************************
 * @fn   			- SPI_ReceiveData
 *
 * @param[in]		- BASE ADDRESS of the SPI Peripheral
 * @param[in]		- pRxBuffer
 * @param[in]		- Length of the message
 *
 * @return			- none
 *
 * @Note			- none
 *
 ***************************************************************************/
void SPI_ReceiveData(SPI_RegDef_t *pSPIx, uint8_t *pRxBuffer, uint32_t Len)
{

}


/*
 * IRQ Configuration and ISR Handling
 */

void GPIO_IRQInterruptConfig(uint8_t IRQNumber, uint8_t EnorDi);
void GPIO_IRQPriorityHandling(uint8_t IRQNumber, uint32_t IRQPriority);
void GPIO_IRQHandling(SPI_Handle_t *pHandle);


























































